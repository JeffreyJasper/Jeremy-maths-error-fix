<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jeremy ç®—æŸ±ä½å€¼ç‰¹è¨“</title>
    <!-- å¼•å…¥ React æ ¸å¿ƒèˆ‡ Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: #f0f9ff;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* ç®—æŸ±ç å­ï¼šç«‹é«”æ¼¸è®Šè‰² */
        .abacus-bead {
            width: 56px;
            height: 32px;
            background: radial-gradient(circle at 30% 30%, #fbbf24, #d97706);
            border-radius: 50%;
            margin-bottom: 4px;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            z-index: 10;
            transition: transform 0.2s;
        }
        
        /* ç®—æŸ±æŸ±å­ */
        .abacus-rod {
            width: 10px;
            height: 220px;
            background-color: #cbd5e1;
            border-radius: 6px;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 0;
        }
        
        /* ç®—æŸ±åº•åº§ */
        .abacus-base {
            height: 20px;
            background-color: #475569;
            border-radius: 10px;
            width: 160px;
            margin-top: -10px;
            z-index: 20;
            position: relative;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        button:active { transform: scale(0.95); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // --- æ‰‹å‹•å®šç¾©åœ–æ¨™ (é¿å… GitHub Pages ç™½å±) ---
        const Icon = {
            Trophy: ({className}) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>,
            Refresh: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><polyline points="21 3 21 8 16 8"/></svg>,
            CheckCircle2: ({size=64, className}) => <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="m9 12 2 2 4-4"/></svg>,
            AlertCircle: ({size=64, className}) => <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>,
            Brain: ({size=48}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .52 6.588A3 3 0 1 0 12 18Z"/><path d="M9 13a4.5 4.5 0 0 0 3-4"/><path d="M6.003 5.125A3 3 0 1 1 12 5"/><path d="M16 8h4"/><path d="M16 12h4"/><path d="M16 16h4"/><path d="M12 18h4"/></svg>
        };

        // --- ç®—æŸ±çµ„ä»¶ ---
        const Abacus = ({ tens, ones, label, highlight }) => {
            return (
                <div className={`flex flex-col items-center p-6 bg-white rounded-[2.5rem] border-4 transition-all duration-300 ${highlight ? 'border-indigo-500 shadow-2xl scale-105 bg-indigo-50' : 'border-slate-200 shadow-lg'}`}>
                    <div className="flex gap-8 mb-4">
                        {/* åä½ */}
                        <div className="relative w-16 h-56 flex flex-col justify-end items-center">
                            <div className="abacus-rod"></div>
                            <div className="z-10 flex flex-col-reverse mb-1 gap-1">
                                {[...Array(tens)].map((_, i) => (
                                    <div key={`t-${i}`} className="abacus-bead"></div>
                                ))}
                            </div>
                            <div className="absolute -bottom-10 font-black text-slate-500 text-xl bg-slate-100 px-3 py-1 rounded-lg">åä½</div>
                        </div>

                        {/* å€‹ä½ */}
                        <div className="relative w-16 h-56 flex flex-col justify-end items-center">
                            <div className="abacus-rod"></div>
                            <div className="z-10 flex flex-col-reverse mb-1 gap-1">
                                {[...Array(ones)].map((_, i) => (
                                    <div key={`o-${i}`} className="abacus-bead"></div>
                                ))}
                            </div>
                            <div className="absolute -bottom-10 font-black text-slate-500 text-xl bg-slate-100 px-3 py-1 rounded-lg">å€‹ä½</div>
                        </div>
                    </div>
                    <div className="abacus-base"></div>
                    <div className="mt-12 font-black text-3xl bg-white border-2 border-slate-100 px-8 py-3 rounded-2xl text-slate-700 min-w-[100px] text-center shadow-inner">
                        {label}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [stage, setStage] = useState('menu'); 
            const [score, setScore] = useState(0);
            const [qCount, setQCount] = useState(0);
            const [currentQ, setCurrentQ] = useState(null);
            const [feedback, setFeedback] = useState(null); 
            const [history, setHistory] = useState([]);

            const TOTAL_QUESTIONS = 10;

            // ç”Ÿæˆé¡Œç›®çš„é‚è¼¯
            const generateQuestion = () => {
                // 60% æ¯”è¼ƒé¡Œ (é‡å°ç¬¬1é¡ŒéŒ¯èª¤)ï¼Œ40% è®€æ•¸é¡Œ (éå›ºä½å€¼æ¦‚å¿µ)
                const type = Math.random() > 0.4 ? 'COMPARE' : 'READ'; 
                let q = { type, id: Date.now() };

                if (type === 'COMPARE') {
                    // é‡å° Jeremy çš„å¼±é»ï¼šç”Ÿæˆå®¹æ˜“æ··æ·†çš„å°æ¯”
                    const patterns = [
                        // ç¶“å…¸éŒ¯èª¤ï¼š20 (2ç²’) vs 12 (3ç²’) -> é›–ç„¶Bç å­å°‘ï¼Œä½†å®ƒæ˜¯20ï¼
                        { t1: 1, o1: 2, t2: 2, o2: 0 }, 
                        { t1: 2, o1: 0, t2: 1, o2: 2 },
                        // å€’è½‰é™·é˜±ï¼š52 vs 25
                        { t1: 5, o1: 2, t2: 2, o2: 5 },
                        { t1: 2, o1: 5, t2: 5, o2: 2 },
                        // 31 vs 13
                        { t1: 3, o1: 1, t2: 1, o2: 3 }, 
                        // 40 vs 4 (å®¹æ˜“å¿½ç•¥å€‹ä½æ²’ç )
                        { t1: 4, o1: 0, t2: 0, o2: 4 }, 
                    ];
                    
                    let p;
                    // 60% æ©Ÿç‡å‡ºé™·é˜±é¡Œï¼Œ40% æ©Ÿç‡éš¨æ©Ÿå‡ºé¡Œ
                    if (Math.random() > 0.4) {
                        p = patterns[Math.floor(Math.random() * patterns.length)];
                    } else {
                        p = { 
                            t1: Math.floor(Math.random() * 6), o1: Math.floor(Math.random() * 9),
                            t2: Math.floor(Math.random() * 6), o2: Math.floor(Math.random() * 9)
                        };
                        // ç¢ºä¿å…©æ•¸ä¸ç›¸ç­‰ä¸”ä¸ç‚º0
                        while ((p.t1 * 10 + p.o1 === p.t2 * 10 + p.o2) || (p.t1===0 && p.o1===0) || (p.t2===0 && p.o2===0)) {
                            p.t2 = Math.floor(Math.random() * 6);
                            p.o2 = Math.floor(Math.random() * 9);
                        }
                    }

                    const valA = p.t1 * 10 + p.o1;
                    const valB = p.t2 * 10 + p.o2;
                    
                    q.data = { A: { t: p.t1, o: p.o1, v: valA }, B: { t: p.t2, o: p.o2, v: valB } };
                    q.text = "å“ªå€‹ç®—æŸ±è¡¨ç¤ºçš„æ•¸æ¯”è¼ƒå¤§ï¼Ÿ";
                    q.correct = valA > valB ? 'A' : 'B';
                } else {
                    // è®€æ•¸é¡Œï¼šè¨“ç·´çœ‹æ¸…æ¥š 0
                    const t = Math.floor(Math.random() * 6); 
                    const o = Math.floor(Math.random() * 10);
                    // å¼·åˆ¶å‡ºç¾ 0 çš„æƒ…æ³ (ä¾‹å¦‚ 30, 40)
                    const finalO = Math.random() > 0.6 ? 0 : o;
                    
                    const correctVal = t * 10 + finalO;
                    if (correctVal === 0) return generateQuestion(); // éæ­¸é‡æŠ½

                    q.data = { A: { t: t, o: finalO, v: correctVal } };
                    q.text = "é€™å€‹ç®—æŸ±è¡¨ç¤ºçš„æ•¸æ˜¯å¤šå°‘ï¼Ÿ";
                    
                    // ç”Ÿæˆæ··æ·†é¸é …
                    let opts = new Set([correctVal]);
                    if (finalO !== 0) opts.add(finalO * 10 + t); // å€’è½‰ (25 -> 52)
                    opts.add(correctVal + 1);
                    opts.add(correctVal + 10);
                    opts.add(t + finalO); // æŠŠç å­åŠ èµ·ä¾†çš„éŒ¯èª¤ (25 -> 7)
                    
                    // è½‰ç‚ºé™£åˆ—ä¸¦éæ¿¾ä¸åˆç†æ•¸å­—
                    let options = Array.from(opts).filter(n => n > 0 && n < 100);
                    while(options.length < 4) {
                        let r = Math.floor(Math.random() * 60) + 1;
                        if (!options.includes(r)) options.push(r);
                    }
                    
                    q.options = options.sort(() => Math.random() - 0.5);
                    q.correct = correctVal;
                }

                setCurrentQ(q);
                setFeedback(null);
            };

            const startQuiz = () => {
                setScore(0);
                setQCount(0);
                setHistory([]);
                setStage('quiz');
                generateQuestion();
            };

            const handleAnswer = (ans) => {
                if (feedback) return;

                const isCorrect = ans.toString() === currentQ.correct.toString();
                if (isCorrect) setScore(s => s + 1);
                
                setFeedback(isCorrect ? 'correct' : 'wrong');
                
                setHistory(prev => [...prev, { ...currentQ, userAns: ans, isCorrect }]);

                // ç­”éŒ¯æ™‚æš«åœä¹…ä¸€é» (3ç§’)ï¼Œè®“ä»–çœ‹æ¸…æ¥š
                setTimeout(() => {
                    if (qCount >= TOTAL_QUESTIONS - 1) {
                        setStage('result');
                    } else {
                        setQCount(c => c + 1);
                        generateQuestion();
                    }
                }, isCorrect ? 1200 : 3000); 
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4">
                    {stage === 'menu' && (
                        <div className="bg-white p-12 rounded-[3rem] shadow-xl text-center max-w-md w-full border-t-8 border-indigo-500 mt-10">
                            <div className="bg-indigo-100 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6">
                                <Icon.Brain size={48} className="text-indigo-600" />
                            </div>
                            <h1 className="text-4xl font-black text-slate-800 mb-4 tracking-tight">ç®—æŸ±ä½å€¼ç‰¹è¨“</h1>
                            <div className="text-slate-500 font-bold mb-10 text-lg space-y-3 bg-slate-50 p-6 rounded-2xl border-2 border-slate-100">
                                <p className="flex items-center gap-2 justify-center"><span className="text-xl">âš ï¸</span> å°å¿ƒï¼š1 ç²’åä½ > 9 ç²’å€‹ä½ï¼</p>
                                <p className="flex items-center gap-2 justify-center"><span className="text-xl">âš ï¸</span> æ³¨æ„ï¼šç©ºä½ä»£è¡¨ 0ï¼</p>
                            </div>
                            <button onClick={startQuiz} className="w-full bg-indigo-600 text-white py-6 rounded-3xl text-2xl font-black shadow-xl active:scale-95 transition-all hover:bg-indigo-700">
                                é–‹å§‹æŒ‘æˆ°
                            </button>
                        </div>
                    )}

                    {stage === 'quiz' && currentQ && (
                        <div className="w-full max-w-2xl">
                            <div className="flex justify-between items-center mb-6 px-4">
                                <span className="bg-white px-5 py-2 rounded-2xl font-black text-slate-400 border border-slate-200 shadow-sm text-lg">
                                    é¡Œè™Ÿ {qCount + 1} / {TOTAL_QUESTIONS}
                                </span>
                                <div className="flex items-center gap-2 text-amber-500 font-black text-3xl">
                                    <Icon.Trophy className="w-8 h-8" /> {score * 10}
                                </div>
                            </div>

                            <div className="bg-white p-10 rounded-[3rem] shadow-xl border border-slate-100 text-center relative overflow-hidden">
                                {feedback && (
                                    <div className={`absolute inset-0 flex flex-col items-center justify-center z-30 ${feedback === 'correct' ? 'bg-green-500/95' : 'bg-rose-500/95'} text-white animate-in fade-in duration-200`}>
                                        {feedback === 'correct' ? (
                                            <>
                                                <Icon.CheckCircle2 className="mb-4 text-white w-20 h-20" />
                                                <h2 className="text-6xl font-black mb-4">ç­”å°äº†ï¼</h2>
                                                <p className="text-2xl font-bold opacity-90">ä½å€¼æ¦‚å¿µå¾ˆæ¸…æ™°ï¼</p>
                                            </>
                                        ) : (
                                            <>
                                                <Icon.AlertCircle className="mb-4 text-white w-20 h-20" />
                                                <h2 className="text-5xl font-black mb-4">å“å‘€ï¼</h2>
                                                <div className="text-2xl font-bold px-8 leading-relaxed bg-white/20 p-6 rounded-2xl backdrop-blur-sm">
                                                    {currentQ.type === 'COMPARE' 
                                                        ? <p>è¨˜å¾—å…ˆçœ‹åä½ï¼<br/><br/>{currentQ.data[currentQ.correct].v} æ¯” {currentQ.data[currentQ.correct === 'A' ? 'B' : 'A'].v} å¤§</p> 
                                                        : <p>æ­£ç¢ºç­”æ¡ˆæ˜¯ <span className="text-4xl block mt-2">{currentQ.correct}</span></p>}
                                                </div>
                                            </>
                                        )}
                                    </div>
                                )}

                                <h2 className="text-3xl font-black text-slate-800 mb-10 tracking-tight">{currentQ.text}</h2>

                                {currentQ.type === 'COMPARE' ? (
                                    <div className="grid grid-cols-2 gap-6 mb-4">
                                        <button onClick={() => handleAnswer('A')} className="active:scale-95 transition-transform outline-none group">
                                            <Abacus tens={currentQ.data.A.t} ones={currentQ.data.A.o} label="ç®—æŸ± A" highlight={feedback && currentQ.correct === 'A'} />
                                            {!feedback && <div className="mt-4 text-indigo-200 font-black text-lg group-hover:text-indigo-600 transition-colors">é¸æ“‡ A</div>}
                                        </button>
                                        <button onClick={() => handleAnswer('B')} className="active:scale-95 transition-transform outline-none group">
                                            <Abacus tens={currentQ.data.B.t} ones={currentQ.data.B.o} label="ç®—æŸ± B" highlight={feedback && currentQ.correct === 'B'} />
                                            {!feedback && <div className="mt-4 text-indigo-200 font-black text-lg group-hover:text-indigo-600 transition-colors">é¸æ“‡ B</div>}
                                        </button>
                                    </div>
                                ) : (
                                    <div className="flex justify-center mb-10">
                                        <Abacus tens={currentQ.data.A.t} ones={currentQ.data.A.o} label="?" />
                                    </div>
                                )}

                                {currentQ.type === 'READ' && (
                                    <div className="grid grid-cols-2 gap-6">
                                        {currentQ.options.map((opt, i) => (
                                            <button 
                                                key={i} 
                                                onClick={() => handleAnswer(opt)}
                                                className="bg-slate-50 border-4 border-slate-100 hover:border-indigo-400 hover:bg-indigo-50 py-8 rounded-[2rem] text-5xl font-black text-indigo-900 transition-all active:scale-95 shadow-sm"
                                            >
                                                {opt}
                                            </button>
                                        ))}
                                    </div>
                                )}
                                
                                {currentQ.type === 'COMPARE' && !feedback && (
                                    <p className="text-base font-bold text-slate-400 animate-pulse mt-6 bg-slate-50 inline-block px-6 py-2 rounded-full">ğŸ‘ˆ é»æ“Šæ¯”è¼ƒå¤§çš„é‚£å€‹ç®—æŸ± ğŸ‘‰</p>
                                )}
                            </div>
                        </div>
                    )}

                    {stage === 'result' && (
                        <div className="bg-white p-12 rounded-[3rem] shadow-2xl text-center max-w-md w-full border-t-8 border-amber-500 animate-in zoom-in duration-300 mt-10">
                            <Icon.Trophy className="text-yellow-400 mx-auto mb-6 animate-bounce w-24 h-24" />
                            <h2 className="text-4xl font-black text-slate-800 mb-2">ç‰¹è¨“å®Œæˆï¼</h2>
                            <p className="text-slate-500 font-bold mb-8">è¨˜å¾—ï¼šä½å€¼å¤§éç å­æ•¸é‡ï¼</p>
                            
                            <div className="bg-indigo-50 rounded-[2rem] p-8 mb-10 border-2 border-indigo-100">
                                <div className="text-sm font-black text-indigo-400 uppercase tracking-widest mb-2">æœ€çµ‚å¾—åˆ†</div>
                                <div className="text-8xl font-black text-indigo-600">{score * 10}</div>
                            </div>

                            <button onClick={startQuiz} className="w-full bg-slate-900 text-white py-6 rounded-3xl font-black text-2xl flex items-center justify-center gap-3 shadow-xl active:scale-95 transition-all hover:bg-slate-800">
                                <Icon.Refresh /> å†åšä¸€æ¬¡
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
